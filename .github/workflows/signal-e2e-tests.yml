name: Signal E2E Tests

on:
  push:
    branches: [main, feature/**]
    paths:
      - 'service/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'
      - '.github/workflows/signal-e2e-tests.yml'
  pull_request:
    branches: [main]
    paths:
      - 'service/**'
      - 'clients/**'
      - 'package.json'
      - 'bun.lock'

jobs:
  e2e-tests:
    name: Run Signal E2E Tests
    uses: metorial/.github/.github/workflows/reusable-e2e-tests.yml@main
    with:
      service_directory: service
      compose_project_prefix: signal-ci
      compose_profiles: 'infra service'
      wait_services: |
        signal-postgres
        signal-redis
        signal-object-storage
        signal-service
      test_container: signal-service
      test_command: cd /app/service && bun run test -- --mode ci --reporter verbose
